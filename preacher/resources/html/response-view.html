<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Response View: {{ response.id }}</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.5.3/css/foundation.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-jsonview/1.2.3/jquery.jsonview.min.css">
  <style>
    body {
      padding: 0em 1em;
    }

    .tabs-title>a {
      font-size: 0.9rem;
    }

    .response-body-raw-content {
      font-size: 14px;
      height: 20em;
    }
  </style>
</head>

<body>

<h1 class="h2">Response Viewer</h1>

<dl>
  <div class="grid-x">
    <dt class="cell medium-2">ID</dt>
    <dd class="cell medium-10">{{ response.id }}</dd>
  </div>
  <div class="grid-x">
    <dt class="cell medium-2">Requested</dt>
    <dd class="cell medium-10">{{ response.request_datetime }}</dd>
  </div>
</dl>

<div class="top-bar">
  <div class="top-bar-left">
    <ul id="response-tabs" class="menu" data-tabs>
      <li class="tabs-title is-active">
        <a href="#response-body">Body</a>
      </li>
      <li class="tabs-title">
        <a href="#response-headers">Headers ({{ response.headers | length }})</a>
      </li>
    </ul>
  </div>
  <div class="top-bar-right">
    <ul class="menu">
      <li class="menu-text">Status: {{ response.status_code }}</li>
      <li class="menu-text">Time: {{ response.elapsed * 1000 }} ms</li>
    </ul>
  </div>
</div>

<div class="tabs-content" data-tabs-content="response-tabs">
  <div id="response-body" class="tabs-panel is-active">
    <ul id="response-body-tabs" class="tabs" data-tabs>
      <li class="tabs-title is-active">
        <a href="#response-body-raw">Raw</a>
      </li>
      <li class="tabs-title">
        <a href="#response-body-json">JSON</a>
      </li>
    </ul>
    <div class="tabs-content" data-tabs-content="response-body-tabs">
      <div id="response-body-raw" class="tabs-panel is-active">
        <pre id="response-body-raw-content">{{ response.body }}</pre>
      </div>
      <div id="response-body-json" class="tabs-panel">
        <div id="response-body-json-content">Loading...</div>
      </div>
    </div>
  </div>

  <div id="response-headers" class="tabs-panel">
    <dl>
      {% for name, value in response.headers.items() %}
      <div class="grid-x">
        <dt class="cell medium-4 large-3">{{ name }}</dt>
        <dd class="cell medium-8 large-9">{{ value }}</dd>
      </div>
      {% endfor %}
    </dl>
  </div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.5.3/js/foundation.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-jsonview/1.2.3/jquery.jsonview.min.js"></script>
<script>
$(document).foundation()

function getBodyAsJson() {
  const bodyRaw = $('#response-body-raw-content').text()
  try {
    return JSON.parse(bodyRaw)
  } catch (e) {
    console.log('Not a JSON body.')
    return undefined
  }

}
const bodyJson = getBodyAsJson()
const $bodyJson = $('#response-body-json-content')
if (bodyJson !== undefined) {
  $bodyJson.JSONView(bodyJson)
  $('#response-body-tabs').foundation('selectTab', $('#response-body-json'), true)
} else {
  $bodyJson.text('Not available for this response')
}
</script>

</body>

</html>
