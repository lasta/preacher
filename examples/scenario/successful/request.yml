label: Request examples

cases:
  - label: Sends headers
    request:
      path: /echo
      headers:
        header-string: xxx
        Header-String: yyy
        user-agent: custom
    response:
      status_code: 200
      headers:
        - describe:
            key: content-type
          should:
            equal: application/json
        - describe:
            key: content-length
            cast_to: int
          should:
            be_greater_than: 100
      body:
        - describe: .headers."Header-String"
          should:
            equal: yyy
        - describe: .headers."User-Agent"
          should:
            equal: custom

  - label: Sends params as a string
    request:
      path: /echo
      params: key=value&spam=ham%26eggs
    response:
      status_code: 200
      body:
        - describe: .args.key
          should:
            contain_exactly:
              - value
        - describe: .args.spam
          should:
            contain_exactly:
              - ham&eggs

  - label: Sends params as a mapping
    request:
      path: /echo
      params:
        key: value
        multi-key:
          - null  # should be ignored.
          - str
          - false
          - 1
          - 1.2
          - 2020-01-23T12:34:56
          - 2020-04-01 01:23:45 +09:00
          - !relative_datetime -6 hours
    response:
      status_code: 200
      body:
        - describe: .args.key
          should:
            contain_exactly:
              - equal: value
        - describe: .args."multi-key"
          should:
            contain_exactly:
              - equal: str
              - equal: "false"
              - equal: "1"
              - equal: "1.2"
              - equal: '2020-01-23T12:34:56'
              - all_of:
                  - equal: '2020-04-01T01:23:45+09:00'
                  - be_before: now
              - all_of:
                  - be_before: now
                  - be_after: -12 hours

  - label: Sends a POST request
    request:
      method: POST
      path: /echo
      params:
        key: value
    response:
      status_code: 200
      body:
        - describe: .method
          should:
            - equal: POST
        - describe: .args.key
          should:
            - contain_exactly:
                - value
